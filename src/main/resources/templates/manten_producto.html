<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="ISO-8859-1">
	<title>PRODUCTOS CUBOX</title>

	<!-- librería Sweetalert -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

	<!-- FontAwesome para íconos -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

	<!-- DataTables CSS -->
	<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">

	<!-- DataTables Buttons CSS -->
	<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
</head>

<body>

	<div id="layoutSidenav_content">
		<main>
			<div class="container-fluid px-4 mt-4">
				<h2 class="my-4">PRODUCTOS</h2>

				<!-- Botón para registrar producto -->
				<a th:href="@{/productos/registrar}" class="btn btn-success mb-4"> <i class="fas fa-user-plus"></i>
					Registrar Producto
				</a>
				
				<a href="/productos/reportes" class="btn btn-warning mb-4" target="_blank">Reporte PDF</a>
				
				<a href="/productos/graficosA" class="btn btn-info mb-4" target="_blank">Grafico 1</a>
				
				<a href="/productos/graficosB" class="btn btn-outline-danger mb-4" target="_blank">Grafico 2</a>
				
				<div style="display: inline;">
					<!-- Botón para regresar a panel-->
					<a th:href="@{/panel}" class="btn btn-secondary mb-4">
						<i class="fa-solid fa-rotate-left"></i> Regresar
					</a>
				</div>

				<!-- Tabla de productos -->
				<div class="table-responsive">
					<table id="datatablesSimple" class="table table-striped table-hover table-bordered align-middle">
						<thead class="table-dark">
							<tr>
								<th>ID</th>
								<th>Id catg</th>
								<th>Id marca</th>
								<th>Nombre</th>
								<th>Descripcion</th>
								<th>Precio</th>
								<th>Precio Oferta</th>
								<th>Stock</th>
								<th>Imagen P.</th>
								<th>Imagen D.</th>
								<th>Imagen T</th>
								<th>Acciones</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="p : ${lstProductos}">
								<td th:text="${p.idproducto}">ID</td>
								<td th:text="${p.idcategoria}">Id catg</td>
								<td th:text="${p.idmarca}">Id marca</td>
								<td th:text="${p.nombre}">Nombre</td>
								<td th:text="${p.descripcion}">Descripcion</td>
								<td th:text="${'S/ '} + ${#numbers.formatDecimal(p.precio, 1, 'COMMA', 2, 'POINT')}">Precio</td>
								<td th:text="${'S/ '} + ${#numbers.formatDecimal(p.precio_oferta, 1, 'COMMA', 2, 'POINT')}">Precio Oferta</td>
								<td th:text="${p.stock}">Stock</td>

								<td>
									<img th:src="@{/productos/ImagenProducto(idproducto=${p.idproducto},tipo='principal')}"
										alt="Imagen Principal" width="120px" height="120px"
										onerror="this.src='/Imagenes/Productos/no-imagen.png'">
								</td>

								<td>
									<img th:src="@{/productos/ImagenProducto(idproducto=${p.idproducto},tipo='dos')}"
										alt="Imagen Secundaria 1" width="120px" height="120px"
										onerror="this.src='/Imagenes/Productos/no-imagen.png'">
								</td>

								<td>
									<img th:src="@{/productos/ImagenProducto(idproducto=${p.idproducto},tipo='tres')}"
										alt="Imagen Secundaria 2" width="120px" height="120px"
										onerror="this.src='/Imagenes/Productos/no-imagen.png'">
								</td>
								
								<td class="text-center">
								  <form style="display:inline;" th:object="${p}">
								    <!-- Botón EDITAR -> hace GET a /productos/editar/{idproducto} -->
								    <button type="submit"
								            th:formaction="@{/productos/editar/} + ${p.idproducto}"
								            formmethod="get"
								            class="btn btn-sm btn-outline-primary me-1"
								            title="Editar">
								      <i class="fas fa-pencil-alt"></i>
								    </button>

								    <!-- Botón ELIMINAR -> hace POST a /usuarios/editar/{idusuario} -->
								    <button type="submit"
								            th:formaction="@{/productos/eliminar/{id}(id=${p.idproducto})}"
								            formmethod="post"
								            class="btn btn-sm btn-outline-danger"
								            title="Eliminar">
								      <i class="fas fa-trash-alt"></i>
								    </button>
								  </form>
								</td>
								
							</tr>
						</tbody>
					</table>
					
					<br><br>
					<div role="alert" th:class="${cssmensaje}" th:text="${mensaje}"></div>
					<div role="alert" th:class="${cssmensaje2}" th:text="${mensaje2}"></div>
					
				</div>
			</div>
		</main>
	</div>

	<!-- Bootstrap JS -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

	<!-- jQuery -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

	<!-- DataTables JS -->
	<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>

	<!-- DataTables Buttons JS -->
	<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
	<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
	<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

	<!-- Inicialización de DataTables con botones -->
	<script>
		$(document).ready(function () {
			$('#datatablesSimple').DataTable({
				language: {
					url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json'
				},
				dom: 'Bfrtip', // activa la barra de botones
				buttons: ['copy', 'excel', 'pdf', 'print']
			});
		});
	</script>

</body>

</html>