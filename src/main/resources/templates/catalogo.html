<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="ISO-8859-1">
	<title>Catálogo</title>

	<link rel="stylesheet" href="/assets/css/styles.css">
	<link rel="stylesheet" href="/assets/css/slaider.css">
	<link rel="stylesheet" href="/assets/css/vendido.css">
	<link rel="stylesheet" href="/assets/css/categorias.css">
	<link rel="stylesheet" href="/assets/css/resenas.css">
	<link rel="stylesheet" href="/assets/css/footer.css">
	<link rel="stylesheet" href="/assets/css/producto.css">

	<!-- librería Sweetalert -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

	<!-- FontAwesome para íconos -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" />

	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link
		href="https://fonts.googleapis.com/css2?family=Mozilla+Headline:wght@200..700&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
		rel="stylesheet">
</head>

<!--  La variable de sesión "usuario" se asigna a u con th:with="u=${session.usuario}" para no romper el resto de referencias ${u.*}. -->
<body th:with="u=${session.user}">

	<!-- Nota: el locale se configura generalmente en Spring; si necesitas manejarlo en la vista, configúralo desde el controlador. -->

	<header class="navbar">
		<div class="nav-container">
			<!-- Logo -->
			<a th:href="@{/principal}" class="logo">
				<img src="https://coolboxpe.vtexassets.com/assets/vtex.file-manager-graphql/images/d9ae27f0-f2b8-458f-b527-38489a24308e___b42588992c82b8e11076b72bf89bf427.svg"
					alt="Coolbox">
			</a>

			<!-- Botón Categorías -->
			<button class="btn-categorias">
				<a th:href="@{/panel}" style="text-decoration: none;"><span class="menu-icon">&#9776;</span> Panel</a>
			</button>

			<!-- Buscador -->
			<div class="search-box">
				<input type="text" placeholder="¿Qué estás buscando?">
				<button class="search-btn">
					<i class="fa-solid fa-magnifying-glass"></i>
				</button>
			</div>

			<!-- Enlaces de usuario -->
			<div class="user-links">
				<a th:href="@{/pedidos/mostrar}"><span><i class="fa-solid fa-bag-shopping"></i></span>
					Mis compras</a>

				<!-- Icons -->
				<div class="d-flex align-items-center" style="padding-right: 10px;">
					
					<a class="btn btn-link text-secondary me-3 position-relative"
					   th:href="@{/carrito/mostrar}">
					  <i class="fa-solid fa-cart-shopping fs-5"></i>
					  <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary"
					        th:text="${cantArticulos}">0</span>
					</a>

					<!-- Menú usuario -->
					<div class="dropdown" style="background-color: coral; border-radius: 25px;">
						<a href="#" class="d-flex align-items-center" id="dropdownUser" data-bs-toggle="dropdown"
							aria-expanded="false">
							<img th:src="@{/Imagenes/Perfil/{id}.jpg(id=${u.idusuario})}" alt="Usuario" class="rounded-circle"
								width="36" height="36" style="object-fit: cover;"
								onerror="this.src='/Imagenes/Perfil/default-user.png'">
						</a>
						<ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="dropdownUser"
							style="width: 250px;">
							<li class="text-center p-3">
								<img th:src="@{/Imagenes/Perfil/{id}.jpg(id=${u.idusuario})}" alt="foto"
									class="rounded-circle mb-2" width="60" height="60"
									style="object-fit: cover; width: 75px;"
									onerror="this.src='/Imagenes/Perfil/default-user.png'">
								<div class="fw-semibold" th:text="${u.nombre}">Nombre Usuario</div>
							</li>
							<li>
								<hr class="dropdown-divider">
							</li>
							<li><a class="dropdown-item" href="#"><i class="fa-regular fa-user me-2"></i>
									Actualizar datos</a></li>
							<li><a class="dropdown-item" href="#"><i
										class="fa-regular fa-circle-question me-2"></i> Ayuda</a></li>
							<li>
								<hr class="dropdown-divider">
							</li>
							<li><a class="dropdown-item text-danger" th:href="@{/logout}"><i
										class="fa-solid fa-arrow-right-from-bracket me-2"></i> Cerrar
									sesión</a></li>
						</ul>
					</div>
				</div>
			</div>

			<!-- Botón hamburguesa en móvil -->
			<div class="mobile-menu-btn" id="mobileMenuBtn">&#9776;</div>
		</div>

		<!-- Menú móvil -->
		<div class="mobile-menu" id="mobileMenu">
			<a th:href="@{/login}">Iniciar sesión</a>
			<a th:href="@{/pedidos/mostrar}">Mis compras</a>
			<a href="#">Categorías</a>
		</div>
	</header>

	<main style="padding: 10px 2px;">
		<div class="container-fluid px-4 mt-4">
			<h2 class="my-4">Catálogo de Productos</h2>

			<!-- Columna de Productos -->
			<div class="col-md-9 mx-auto">
				<div class="row row-cols-1 row-cols-md-4 g-4 justify-content-center">
					<div class="col" th:each="p : ${lstProductos}">
						<div class="card h-100">
							<img class="card-img-top" th:src="@{/productos/ImagenProducto(idproducto=${p.idproducto},tipo='principal')}"
								alt="imagen del producto" style="height: 220px;"
								onerror="this.src='/Imagenes/Productos/no-imagen.png';">
                   <!-- 	<img class="card-img-top" th:src="@{/Imagenes/Productos/{id}.jpg(id=${p.idproducto})}"
									alt="imagen del producto" style="height: 220px;"
									onerror="this.src='/Imagenes/Productos/no-imagen.png';"> -->
							<div class="card-body" style="background-color: lightblue;">
								<h5 class="card-title" th:text="${p.nombre}">Nombre Producto</h5>
								<p class="card-text">
									<strong>Stock:</strong> <span th:text="${p.stock}">0</span><br>
									<strong>Precio:</strong>
									<span th:text="${'S/ '} + 
										${#numbers.formatDecimal(p.precio, 1, 'COMMA', 2, 'POINT')}">S/. 0.00</span>
									<span th:if="${p.precio_oferta != 0.00}">
										<br>
										<strong>Precio Oferta:</strong>
										<span th:text="${'S/ '} + ${#numbers.formatDecimal(p.precio_oferta, 1, 'COMMA', 2, 'POINT')}">S/. 0.00</span>
									</span>
								</p>
							</div>
							<div class="card-footer text-end">
								<a class="btn btn-outline-primary" th:if="${p.stock > 0}"
									th:href="@{/carrito/seleccionar/{id}(id=${p.idproducto})}"
									onclick="return confirm('¿Procesar?')">Añadir</a>

								<button type="button" class="btn btn-primary" disabled
									th:if="${p.stock == 0}">Añadir</button>
							</div>
						</div>
					</div> <!-- /producto -->
				</div>
			</div>
			<br>
		</div>
	</main>

	<!-- Bootstrap JS -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

	<!-- jQuery -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</body>

</html>